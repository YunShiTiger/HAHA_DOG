# DockerRegsitry



### 拉取镜像

```
docker pull regsitry
```



### 运行

```
docker run -d --name dockerhub --restart always -p 5000:5000 -v /home/data/docker/registry:/tmp/registry docker.io/registry 
```

可能会报错，`iptables failed: iptables --wait -t nat -A DOCKER ...` 添加iptables配置： 

```
# Generated by iptables-save v1.4.21 on Thu Nov 30 00:04:59 2017
*filter
:INPUT ACCEPT [465:42131]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [369:72564]
:DOCKER - [0:0]
-A FORWARD -o docker0 -j DOCKER
-A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -i docker0 ! -o docker0 -j ACCEPT
-A FORWARD -i docker0 -o docker0 -j ACCEPT
COMMIT
# Completed on Thu Nov 30 00:04:59 2017
# Generated by iptables-save v1.4.21 on Thu Nov 30 00:04:59 2017
*nat
:PREROUTING ACCEPT [9:1871]
:INPUT ACCEPT [1:255]
:OUTPUT ACCEPT [1:252]
:POSTROUTING ACCEPT [1:252]
:DOCKER - [0:0]
-A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER
-A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER
-A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE
COMMIT
# Completed on Thu Nov 30 00:04:59 2017
```



### 访问

```	
curl -X GET http://59.212.147.64:5000/v2/_catalog
```

```
{"repositories":[]}   
#私有仓库为空，没有提交新镜像到仓库中
```



### 修改改Docker配置文件指向私有仓库url

```
vim /etc/sysconfig/docker
```

##### 有些版本

```
vi /lib/systemd/system/docker.service
```

或

```
OPTIONS='--selinux-enabled --insecure-registry 59.212.147.64:5000'
```

或

```
ExecStart=/usr/bin/dockerd --insecure-registry 59.212.147.64:5000
```

### 重启docker

```
systemctl daemon-reload
```

```
systemctl restart docker
```



### 给镜像标记对应docker regsity标签

```
docker tag 5958914cc558 59.212.147.64:5000/redis:6.0
```

### 提交镜像到本地私有仓库中

```
docker push 59.212.147.64:5000/redis:6.0
```



### 查看私有仓库是否存在对应的镜像

```
curl -X GET http://59.212.147.64:5000/v2/_catalog
```

打印出

```
{"repositories":["redis"]}
```

查看镜像详细信息

```
curl -X GET http://59.212.147.64:5000/v2/redis/tags/list
```

打印出

```
{"name":"redis","tags":["6.0"]}
```

​      

